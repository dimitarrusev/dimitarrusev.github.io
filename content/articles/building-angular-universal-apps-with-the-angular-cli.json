{"title":"Building Angular Universal Applications with the Angular CLI","date":"2018-02-06","category":"angular","tags":["angular cli","angular universal","server-side rendering","pre-rendering"],"slug":"building-angular-universal-apps-with-the-angular-cli","content":"<p>As of Angular 4.0, Angular Universal, which initially started as a community-driven project, is part of the Angular core. Being a part of the framework itself brings many benefits, but most importantly it guarantees stability. </p>\n<p>Angular Universal is a technology that runs Angular applications on the server. It brings a set of tools that, among other things, enable generating static HTML pages through a process widely known as server-side rendering (or pre-rendering). It is performed to satisfy mainly three priorities i.e. to make an app:</p>\n<ul>\n<li>perceived as as fast loading</li>\n<li>scrapable by social network robots</li>\n<li>crawlable by search engines</li>\n</ul>\n<p>Angular Universal was initially built to work with <a href=\"https://nodejs.org\">Node.js</a>. Engines for the most popular frameworks such as <a href=\"https://github.com/angular/universal/tree/master/modules/express-engine\">Express</a> and <a href=\"https://github.com/angular/universal/tree/master/modules/hapi-engine\">Hapi</a> are available. In addition to Node.js, Angular Universal has <a href=\"https://github.com/aspnet/JavaScriptServices\">ASP.NET Core</a> support and a bridge protocol to communicate with different language backends like <a href=\"https://www.djangoproject.com/\">Django</a>, <a href=\"https://golang.org/\">Go</a> and <a href=\"http://php.net/\">PHP</a> is expected in the future.</p>\n<p>The goal of this guide is not to merely introduce you, but to also give you a deeper understanding of the inner workings of Angular Universal. It&#39;ll walk you through the process of integrating Angular Universal into an existing CLI generated project and show you how to pre-render an application on the server.</p>\n<h2 id=\"prerequisites\">Prerequisites</h2>\n<p>Both the Angular CLI and the generated project have dependencies that require Node.js <code>6.9.0</code> or higher, together with NPM <code>3</code> or higher installed on your system.</p>\n<p>The bare minimum requirements are:</p>\n<ul>\n<li>Angular CLI version <code>1.3.0</code> and above</li>\n<li>Angular version <code>4.0.0</code> and above</li>\n<li>Angular Universal version <code>4.0.0</code> and above</li>\n</ul>\n<p>This article is based on:</p>\n<ul>\n<li>Angular CLI version <code>1.6.6</code></li>\n<li>Angular version <code>5.2.3</code></li>\n<li>Angular Universal version <code>5.2.3</code></li>\n</ul>\n<h2 id=\"get-started\">Get started</h2>\n<p>I&#39;m assuming that you are already familiar with the Angular CLI. If not, please check out the <a href=\"https://github.com/angular/angular-cli#usage\">usage section</a> in the official documentation. </p>\n<p>We&#39;ll begin by generating a new project:</p>\n<pre class=\"language-bash\"><code class=\"language-bash\">ng new my-angular-universal-app\n<span class=\"token function\">cd</span> my-angular-universal-app</code></pre><p>At this point we have a standard Angular application. In it&#39;s current state it is not able to run in a server environment, mainly because the module format is incorrect. To fix that we need a universal bundle. </p>\n<p>A universal bundle is a <a href=\"http://requirejs.org/docs/commonjs.html\">CommonJS</a> formatted build of the application which can be used in a Node context. Generating such bundle is supported by the Angular CLI, but it doesn&#39;t work out of the box. It takes a bit of configuration, which is what we&#39;re going to do next.</p>\n<h2 id=\"integrate-angular-universal\">Integrate Angular Universal</h2>\n<p>Angular CLI version <code>1.6</code> offers an automatic way to integrate Angular Universal into an existing CLI generated project through <a href=\"https://github.com/angular/devkit/blob/master/packages/angular_devkit/schematics/README.md\">Schematics</a>. It is as simple as running a single command:</p>\n<pre class=\"language-bash\"><code class=\"language-bash\">ng generate universal server</code></pre><p>It will integrate Angular Universal and configure the Angular CLI, leaving you only to build the application and handle pre-rendering logistics. However, in order to better understand the inner workings, we&#39;ll take the road less traveled and do the work by hand.</p>\n<h3 id=\"install-dependencies\">Install dependencies</h3>\n<p>Angular Universal is available to us through the <code>@angular/platform-server</code> module. It contains server implementations of the <a href=\"https://github.com/angular/angular/blob/5.0.1/packages/platform-server/src/domino_adapter.ts\">DOM</a>, <a href=\"https://github.com/angular/angular/blob/5.0.1/packages/platform-server/src/server_renderer.ts\">Renderer</a>, <a href=\"https://github.com/angular/angular/blob/5.0.1/packages/platform-server/src/styles_host.ts\">Styles Host</a>, <a href=\"https://github.com/angular/angular/blob/5.0.1/packages/platform-server/src/http.ts\">XHR</a>, <a href=\"https://github.com/angular/angular/blob/5.0.1/packages/platform-server/src/location.ts\">Location</a> and other browser independent low-level features. We&#39;ll compile our application with this module instead of <code>platform-browser</code> to generate the universal bundle.</p>\n<p>To Install it in your project, run the following command:</p>\n<pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">npm</span> <span class=\"token function\">install</span> @angular/platform-server --save</code></pre><p>Before moving forward, it&#39;s important to make sure that every Angular package is on the same version. This minimal effort will prevent issues that may rise up from package version mismatch later on.</p>\n<p><strong>package.json</strong></p>\n<pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  // ... \n    <span class=\"token property\">\"dependencies\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"@angular/animations\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^5.2.3\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"@angular/common\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^5.2.3\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"@angular/compiler\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^5.2.3\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"@angular/core\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^5.2.3\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"@angular/forms\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^5.2.3\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"@angular/http\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^5.2.3\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"@angular/platform-browser\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^5.2.3\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"@angular/platform-browser-dynamic\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^5.2.3\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"@angular/platform-server\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^5.2.3\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"@angular/router\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^5.2.3\"</span><span class=\"token punctuation\">,</span>\n    // ...\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"devDependencies\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"@angular/cli\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"1.6.6\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"@angular/compiler-cli\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^5.2.3\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"@angular/language-service\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^5.2.3\"</span><span class=\"token punctuation\">,</span>\n    // ...\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre><h3 id=\"create-platform-specific-modules\">Create platform-specific modules</h3>\n<p>Traditional Angular applications have only one top-level module. In our case, we need two. Each for its respective platform.</p>\n<h4 id=\"browser-module\">Browser module</h4>\n<p>Our browser module is already in place. The only modifications we&#39;re going to make to it is change its name and make it aware of a server transition.</p>\n<p>The reason we&#39;re renaming it is to clearly express what it represents and also to maintain naming consistency. Down the road we&#39;ll need to create another top-level module specifically for the server platform, and obviously, we&#39;ll need to be able to easily differentiate between the two.</p>\n<p>As far as naming goes, we&#39;ll stick to the recommended pattern outlined in the <a href=\"https://angular.io/guide/styleguide#general-naming-guidelines\">general naming guidelines</a> i.e. <code>feature.type.ts</code>.</p>\n<pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">mv</span> src/app.module.ts src/app-browser.module.ts</code></pre><p>Reflect the change to the module name as well:</p>\n<p><strong>src/app/app-browser.module.ts</strong></p>\n<pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> BrowserModule <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@angular/platform-browser'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> NgModule <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@angular/core'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> AppComponent <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./app.component'</span><span class=\"token punctuation\">;</span>\n\n@<span class=\"token function\">NgModule</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  declarations<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>\n    AppComponent\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  imports<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>\n    BrowserModule\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  providers<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  bootstrap<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>AppComponent<span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">AppBrowserModule</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span> <span class=\"token comment\" spellcheck=\"true\">// Rename AppModule to AppBrowserModule</span></code></pre><p>Lastly, we need to let the browser module know that this is an application initially rendered on a server. We do that by invoking the <a href=\"https://github.com/angular/angular/blob/master/packages/platform-browser/src/browser.ts#L106\">withServerTransition</a> method on the <code>BrowserModule</code> import in the module&#39;s metadata and pass a unique application identifier. This method acts as an interface between the server and browser applications and allows Angular to perform the processing necessary to take over a server rendered application.</p>\n<p>The application identifier can be any identifier that is unique on the page, the only requirement being that it must match between the two applications. Angular adds this identifier to the style names of the server rendered components, so that they can be identified and removed once the browser application bootstraps.</p>\n<p><strong>src/app/app-browser.module.ts</strong></p>\n<pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> NgModule <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@angular/core'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> BrowserModule <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@angular/platform-browser'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> AppComponent <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./app.component'</span><span class=\"token punctuation\">;</span>\n\n@<span class=\"token function\">NgModule</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  declarations<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>\n    AppComponent\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  imports<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>\n    BrowserModule<span class=\"token punctuation\">.</span><span class=\"token function\">withServerTransition</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> appId<span class=\"token punctuation\">:</span> <span class=\"token string\">'my-app-id'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token comment\" spellcheck=\"true\">// Invoke `withServerTransition()` with a unique `appId`</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  providers<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  bootstrap<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>AppComponent<span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">AppBrowserModule</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span></code></pre><h4 id=\"server-module\">Server module</h4>\n<p>Setting up the server module requires a bit more effort. This time, in addition to creating the module itself, we&#39;ll need to create an entry point for it and configure the TypeScript compiler to tell TypeScript how to build it. This is standard procedure for every top-level module and the browser module is no exception, it&#39;s just that previously the Angular CLI did the work for us.</p>\n<p>The server module wraps the browser module so it can mediate between the two and provides Angular with bootstrapping instructions when running in server context. It&#39;s also a place where any server specific code is registered.</p>\n<p>Start by creating a file for the module:</p>\n<pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">touch</span> src/app/app-server.module.ts</code></pre><p>And add the following code:</p>\n<p><strong>src/app/app-server.module.ts</strong></p>\n<pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> NgModule <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@angular/core'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> ServerModule <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@angular/platform-server'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> AppBrowserModule <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./app-browser.module'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> AppComponent <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./app.component'</span><span class=\"token punctuation\">;</span>\n\n@<span class=\"token function\">NgModule</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  imports<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>\n    AppBrowserModule<span class=\"token punctuation\">,</span> <span class=\"token comment\" spellcheck=\"true\">// `AppBrowserModule` should be followed by the `ServerModule`</span>\n    ServerModule\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  bootstrap<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>AppComponent<span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">AppServerModule</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span></code></pre><p>Pay attention to the module import order in the module&#39;s metadata.</p>\n<h3 id=\"create-module-entry-points\">Create module entry points</h3>\n<p>Similarly like the step before last, we&#39;ll begin by changing the name of the entry point for the applications browser module:</p>\n<pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">mv</span> src/main.ts src/main-browser.ts</code></pre><p>And make the following modifications:</p>\n<p><strong>main-browser.ts</strong></p>\n<pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> enableProdMode <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@angular/core'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> platformBrowserDynamic <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@angular/platform-browser-dynamic'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token string\">'hammerjs'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> AppBrowserModule <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./app/app-browser.module'</span><span class=\"token punctuation\">;</span> <span class=\"token comment\" spellcheck=\"true\">// Reflect the changes to the file and module names we did previously</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> environment <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./environments/environment'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>environment<span class=\"token punctuation\">.</span>production<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">enableProdMode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token function\">platformBrowserDynamic</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">bootstrapModule</span><span class=\"token punctuation\">(</span>AppBrowserModule<span class=\"token punctuation\">)</span> <span class=\"token comment\" spellcheck=\"true\">// Reflect the module name change here as well</span>\n                        <span class=\"token punctuation\">.</span><span class=\"token keyword\">catch</span><span class=\"token punctuation\">(</span>err <span class=\"token operator\">=></span> console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre><p>Then create an entry point for the server module:</p>\n<pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">touch</span> src/main-server.ts</code></pre><p>And add the following code:</p>\n<p><strong>src/main-server.ts</strong></p>\n<pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">export</span> <span class=\"token punctuation\">{</span> AppServerModule <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./app/app-server.module'</span><span class=\"token punctuation\">;</span></code></pre><p>It&#39;s only job is to export the server module.</p>\n<h3 id=\"configure-the-compilers\">Configure the compilers</h3>\n<p>An Angular application is composed mainly of components and their HTML templates. Before the browser can render the application, the components and templates must be converted to executable JavaScript — a workload divided between the TypeScript and Angular compiler.</p>\n<h4 id=\"typescript-compiler\">TypeScript compiler</h4>\n<p>Configuring the TypeScript compiler for the server application requires its own configuration file, mainly because the transpiled code needs to be in a different format than the one specified in the current configuration.</p>\n<p>In addition to that, we need to add a specific section to guide the Angular compiler and let it know about the entry module of the server application.</p>\n<p>Start by renaming the <code>tsconfig.app.json</code> file to <code>tsconfig-browser.app.json</code>:</p>\n<pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">mv</span> src/tsconfig.app.json src/tsconfig-browser.app.json</code></pre><p>Then create a configuration file for the server application by taking the configuration for the browser application as a starting point:</p>\n<pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">cp</span> src/tsconfig-browser.app.json src/tsconfig-server.app.json</code></pre><p>And make the following modifications:</p>\n<pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"extends\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"../tsconfig.json\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"compilerOptions\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"outDir\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"../out-tsc/app\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"baseUrl\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"./\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"module\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"commonjs\"</span><span class=\"token punctuation\">,</span> // Change the module format from `ES2015` to `CommonJS`\n    <span class=\"token property\">\"types\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"exclude\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token string\">\"test.ts\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"**/*.spec.ts\"</span>\n  <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span></code></pre><h4 id=\"angular-compiler\">Angular compiler</h4>\n<p>Finally, add <code>angularCompilerOptions</code> section with an <code>entryModule</code> property pointing to the server module expressed in the following format: <code>path/to/file#ClassName</code>:</p>\n<pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"extends\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"../tsconfig.json\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"compilerOptions\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"outDir\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"../out-tsc/app\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"baseUrl\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"./\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"module\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"commonjs\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"types\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"angularCompilerOptions\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> // Add `angularCompilerOptions` section\n    <span class=\"token property\">\"entryModule\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"app/app-server.module#AppServerModule\"</span> // Add `entryModule` property pointing to the server module\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"exclude\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token string\">\"test.ts\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"**/*.spec.ts\"</span>\n  <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span></code></pre><h3 id=\"configure-the-angular-cli\">Configure the Angular CLI</h3>\n<p>Last but not least, we need to instruct the Angular CLI on how to build our bundle. The Angular CLI is an abstraction on top of Webpack and it&#39;s controlled through a special configuration file.</p>\n<p>We&#39;ll begin by updating the configuration settings for the browser application:</p>\n<p><strong>.angular-cli.json</strong></p>\n<pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"$schema\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"./node_modules/@angular/cli/lib/config/schema.json\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"project\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"my-angular-universal-app\"</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"apps\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"browser\"</span><span class=\"token punctuation\">,</span> // Add a name\n      <span class=\"token property\">\"root\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"src\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"outDir\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"dist/browser\"</span><span class=\"token punctuation\">,</span> // Change the output directory\n      <span class=\"token property\">\"assets\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"index\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"index.html\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"main\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"main-browser.ts\"</span><span class=\"token punctuation\">,</span> // Update the entry point\n      <span class=\"token property\">\"polyfills\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"polyfills.ts\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"test\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"test.ts\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"tsconfig\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"tsconfig-browser.json\"</span><span class=\"token punctuation\">,</span> // Update the tsconfig\n      <span class=\"token property\">\"testTsconfig\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"tsconfig.spec.json\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"prefix\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"app\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"styles\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n        <span class=\"token string\">\"styles.scss\"</span>\n      <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"scripts\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"environmentSource\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"environments/environment.ts\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"environments\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">\"dev\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"environments/environment.ts\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"prod\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"environments/environment.prod.ts\"</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"test\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"karma\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"config\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"./karma.conf.js\"</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"defaults\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"styleExt\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"scss\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"component\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre><p>Then copy the configuration and use it as a starting point for the server application with the following modifications:</p>\n<p><strong>.angular-cli.json</strong></p>\n<pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"$schema\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"./node_modules/@angular/cli/lib/config/schema.json\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"project\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"my-angular-universal-app\"</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"apps\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"browser\"</span><span class=\"token punctuation\">,</span>\n      //\n      // ...\n      //\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"server\"</span><span class=\"token punctuation\">,</span> // Update the name\n      <span class=\"token property\">\"platform\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"server\"</span><span class=\"token punctuation\">,</span> // Add a platform\n      <span class=\"token property\">\"root\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"src\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"outDir\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"dist/server\"</span><span class=\"token punctuation\">,</span> // Update the output directory\n      <span class=\"token property\">\"assets\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"index\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"index.html\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"main\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"main-server.ts\"</span><span class=\"token punctuation\">,</span> // Update the entry point\n      // <span class=\"token property\">\"polyfills\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"polyfills.ts\"</span><span class=\"token punctuation\">,</span> // Remove the polyfills\n      <span class=\"token property\">\"test\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"test.ts\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"tsconfig\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"tsconfig-server.json\"</span><span class=\"token punctuation\">,</span> // Update the tsconfig\n      <span class=\"token property\">\"testTsconfig\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"tsconfig.spec.json\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"prefix\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"app\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"styles\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n        <span class=\"token string\">\"styles.scss\"</span>\n      <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"scripts\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"environmentSource\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"environments/environment.ts\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"environments\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">\"dev\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"environments/environment.ts\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"prod\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"environments/environment.prod.ts\"</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"test\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"karma\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"config\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"./karma.conf.js\"</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"defaults\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"styleExt\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"scss\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"component\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre><p>This configuration file links all the files we created previously. With it done, we&#39;re ready to build.</p>\n<h3 id=\"build-the-application\">Build the application</h3>\n<p>To build the application we use the <code>ng build</code> command along with a few flags to tailor our build:</p>\n<pre class=\"language-bash\"><code class=\"language-bash\">ng build --app server --prod --output-hashing none</code></pre><ul>\n<li><code>--app server</code> specifies the application we want to to build.</li>\n<li><code>--prod</code> is a meta-flag that sets other flags. It specifies the build target, builds with <code>AOT</code> and sets cache-busting mode for all files by default.</li>\n<li><code>--output-hashing none</code> disables the cache-busting mode set by the <code>--prod</code> flag. We do this because we don&#39;t need the hashes on the server.</li>\n</ul>\n<p>Let&#39;s create a run script for easier usage in the future. Open up <code>package.json</code> and make the following modifications:</p>\n<p><strong>package.json</strong></p>\n<pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"my-angular-universal-app\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"version\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"0.0.0\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"license\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"MIT\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"scripts\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"ng\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"ng\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"start\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"ng serve\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"build:browser\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"ng build --app browser --prod\"</span><span class=\"token punctuation\">,</span> // &lt;-- Update `ng build` to `ng build<span class=\"token operator\">:</span>browser`\n    <span class=\"token property\">\"build:server\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"ng build --app server --prod --output-hashing none\"</span><span class=\"token punctuation\">,</span> // &lt;-- Add `ng build<span class=\"token operator\">:</span>server`\n    <span class=\"token property\">\"test\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"ng test\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"lint\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"ng lint\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"e2e\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"ng e2e\"</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  // ...\n<span class=\"token punctuation\">}</span></code></pre><p>Now build it:</p>\n<pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">npm</span> run build:server</code></pre><p>Upon execution, you should get an output similar to this one:</p>\n<pre class=\"language-bash\"><code class=\"language-bash\">Date: 2018-01-29T12:11:54.794Z\nHash: f068dbec42033c900e79\nTime: 4073ms\nchunk <span class=\"token punctuation\">{</span>0<span class=\"token punctuation\">}</span> main.bundle.js <span class=\"token punctuation\">(</span>main<span class=\"token punctuation\">)</span> 9.57 kB <span class=\"token punctuation\">[</span>entry<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span>rendered<span class=\"token punctuation\">]</span>\nchunk <span class=\"token punctuation\">{</span>1<span class=\"token punctuation\">}</span> styles.bundle.css <span class=\"token punctuation\">(</span>styles<span class=\"token punctuation\">)</span> 79 bytes <span class=\"token punctuation\">[</span>entry<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span>rendered<span class=\"token punctuation\">]</span></code></pre><p>Congratulations, you have successfully built your universal bundle!</p>\n<h2 id=\"pre-rendering\">Pre-rendering</h2>\n<p>The process of generating static HTML documents prior to the application being bootstrapped in the browser is referred to by different terms. Personally, i find the term <code>pre-rendering</code> most suitable in the current context and that&#39;s how i&#39;ll refer to it from now on.</p>\n<p>To generate static HTML document for a given route we use a utility function called <code>renderModuleFactory</code>, provided to us by the <code>@angular/platform-server</code> module.</p>\n<pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">function</span> renderModuleFactory<span class=\"token operator\">&lt;</span>T<span class=\"token operator\">></span><span class=\"token punctuation\">(</span>moduleFactory<span class=\"token punctuation\">:</span> NgModuleFactory<span class=\"token operator\">&lt;</span>T<span class=\"token operator\">></span><span class=\"token punctuation\">,</span> options<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n    document<span class=\"token operator\">?</span><span class=\"token punctuation\">:</span> <span class=\"token keyword\">string</span><span class=\"token punctuation\">;</span>\n    url<span class=\"token operator\">?</span><span class=\"token punctuation\">:</span> <span class=\"token keyword\">string</span><span class=\"token punctuation\">;</span>\n    extraProviders<span class=\"token operator\">?</span><span class=\"token punctuation\">:</span> StaticProvider<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> Promise<span class=\"token operator\">&lt;</span><span class=\"token keyword\">string</span><span class=\"token operator\">></span><span class=\"token punctuation\">;</span></code></pre><p>It takes as arguments a <code>moduleFactory</code> and <code>options</code> object containing an HTML <code>document</code>, a <code>url</code> and optional <code>extraProviders</code> for the render request and returns a promise that either resolves with a fully-rendered page or rejects with a reason.</p>\n<p>Pre-rendering can be performed manually, during build time, using a build tool or dynamically, at runtime, using a web server. Both approaches have their use cases, advantages and disadvantages, but essentially it&#39;s a matter of flexibility, scalability and performance.</p>\n<p>We&#39;ve been writing our Angular apps in TypeScript all this time, so i&#39;m assuming that we&#39;ve all adopted the language by now. We&#39;re going to write the server code in TypeScript as well. Let&#39;s prepare.</p>\n<h3 id=\"configure-typescript-for-the-server\">Configure TypeScript for the server</h3>\n<p>This step is required only because we&#39;ve chosen to write our server code in TypeScript. If you want to use JavaScript instead, feel free to skip it.</p>\n<p>In the projects root, create another <code>tsconfig</code>  file:</p>\n<pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">touch</span> tsconfig.server.json</code></pre><p>And add the following configuration:</p>\n<p><strong>tsconfig.server.json</strong></p>\n<pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"compilerOptions\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"baseUrl\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"./\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"module\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"commonjs\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"target\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"es2015\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"outDir\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"dist\"</span>\n   <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n   <span class=\"token property\">\"include\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n     <span class=\"token string\">\"prerender.ts\"</span><span class=\"token punctuation\">,</span>\n     <span class=\"token string\">\"server.ts\"</span>\n   <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span></code></pre><p>It tells the compiler to look for files in the current directory named <code>prerender.ts</code> and <code>server.ts</code>, transpile them from <code>es2015</code> to <code>commonjs</code> and put the results in the <code>dist</code> directory.</p>\n<h3 id=\"pre-rendering-at-build-time\">Pre-rendering at build time</h3>\n<p>Pre-rendering at build time is great for static sites. It is highly scalable, performant and it can be accomplished with a simple command line script that can be manually executed or integrated into a continuous integration service. Let&#39;s write one.</p>\n<p>In the projects root create a file named <code>prerender.ts</code>:</p>\n<pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">touch</span> prerender.ts</code></pre><p>And add the following code:</p>\n<p><strong>prerender.ts</strong></p>\n<pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> readFileSync <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'fs'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">import</span> <span class=\"token string\">'zone.js/dist/zone-node'</span><span class=\"token punctuation\">;</span>                                             <span class=\"token comment\" spellcheck=\"true\">// Node compatible version of zone.js. Required by Angular Universal.</span>\n<span class=\"token keyword\">import</span> <span class=\"token string\">'reflect-metadata'</span><span class=\"token punctuation\">;</span>                                                     <span class=\"token comment\" spellcheck=\"true\">// Metadata reflection API. Required by Angular Universal.</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> renderModuleFactory <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@angular/platform-server'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> AppServerModuleNgFactory <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./server/main.bundle.js'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>      <span class=\"token comment\" spellcheck=\"true\">// Compiled Angular application in CommonJS format. Notice that here, we're using `require` instead of `import`.</span>\n\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> enableProdMode <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@angular/core'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token function\">enableProdMode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> ARGS <span class=\"token operator\">=</span> process<span class=\"token punctuation\">.</span>argv<span class=\"token punctuation\">.</span><span class=\"token function\">slice</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>                                            <span class=\"token comment\" spellcheck=\"true\">// Command line arguments</span>\n<span class=\"token keyword\">const</span> DOCUMENT <span class=\"token operator\">=</span> <span class=\"token function\">readFileSync</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./dist/browser/index.html'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'utf-8'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>        <span class=\"token comment\" spellcheck=\"true\">// HTML document to be used as a template.</span>\n<span class=\"token keyword\">const</span> URL <span class=\"token operator\">=</span> ARGS<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>                                                        <span class=\"token comment\" spellcheck=\"true\">// URL for the render request.</span>\n\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>ARGS<span class=\"token punctuation\">.</span>length <span class=\"token operator\">!==</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  process<span class=\"token punctuation\">.</span>stdout<span class=\"token punctuation\">.</span><span class=\"token function\">write</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Usage: node dist/prerender.js &lt;url>'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  process<span class=\"token punctuation\">.</span><span class=\"token function\">exit</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">renderModuleFactory</span><span class=\"token punctuation\">(</span>AppServerModuleNgFactory<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> \n    document<span class=\"token punctuation\">:</span> DOCUMENT<span class=\"token punctuation\">,</span> \n    url<span class=\"token punctuation\">:</span> URL \n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span>html <span class=\"token operator\">=></span> process<span class=\"token punctuation\">.</span>stdout<span class=\"token punctuation\">.</span><span class=\"token function\">write</span><span class=\"token punctuation\">(</span>html<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token keyword\">catch</span><span class=\"token punctuation\">(</span>err <span class=\"token operator\">=></span> process<span class=\"token punctuation\">.</span>stdout<span class=\"token punctuation\">.</span><span class=\"token function\">write</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre><p>The script takes as argument the URL for the render request and returns a fully-rendered page or an error if something goes wrong. </p>\n<p>Prior to execution, run the TypeScript compiler to transpile the code:</p>\n<pre class=\"language-bash\"><code class=\"language-bash\">node_modules/.bin/tsc --project tsconfig.server.json</code></pre><p>If you haven&#39;t done so already, build both apps:</p>\n<pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">npm</span> run build:browser <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">npm</span> run build:server</code></pre><p>Then run the script:</p>\n<pre class=\"language-bash\"><code class=\"language-bash\">node dist/prerender.js /</code></pre><p>You should get the following output:</p>\n<pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token operator\">&lt;</span><span class=\"token operator\">!</span>DOCTYPE html<span class=\"token operator\">></span><span class=\"token operator\">&lt;</span>html lang<span class=\"token operator\">=</span><span class=\"token string\">\"en\"</span><span class=\"token operator\">></span><span class=\"token operator\">&lt;</span>head<span class=\"token operator\">></span><span class=\"token operator\">&lt;</span>meta charset<span class=\"token operator\">=</span><span class=\"token string\">\"utf-8\"</span><span class=\"token operator\">></span><span class=\"token operator\">&lt;</span>title<span class=\"token operator\">></span>IntroductionToAngularUniversal<span class=\"token operator\">&lt;</span>/title<span class=\"token operator\">></span><span class=\"token operator\">&lt;</span>base href<span class=\"token operator\">=</span><span class=\"token string\">\"/\"</span><span class=\"token operator\">></span><span class=\"token operator\">&lt;</span>meta name<span class=\"token operator\">=</span><span class=\"token string\">\"viewport\"</span> content<span class=\"token operator\">=</span><span class=\"token string\">\"width=device-width,initial-scale=1\"</span><span class=\"token operator\">></span><span class=\"token operator\">&lt;</span>link rel<span class=\"token operator\">=</span><span class=\"token string\">\"icon\"</span> type<span class=\"token operator\">=</span><span class=\"token string\">\"image/x-icon\"</span> href<span class=\"token operator\">=</span><span class=\"token string\">\"favicon.ico\"</span><span class=\"token operator\">></span><span class=\"token operator\">&lt;</span>link href<span class=\"token operator\">=</span><span class=\"token string\">\"styles.9c0ad738f18adc3d19ed.bundle.css\"</span> rel<span class=\"token operator\">=</span><span class=\"token string\">\"stylesheet\"</span><span class=\"token operator\">></span><span class=\"token operator\">&lt;</span>style ng-transition<span class=\"token operator\">=</span><span class=\"token string\">\"my-app-id\"</span><span class=\"token operator\">></span><span class=\"token operator\">&lt;</span>/style<span class=\"token operator\">></span><span class=\"token operator\">&lt;</span>/head<span class=\"token operator\">></span><span class=\"token operator\">&lt;</span>body<span class=\"token operator\">></span><span class=\"token operator\">&lt;</span>app-root _nghost-c0<span class=\"token operator\">=</span><span class=\"token string\">\"\"</span> ng-version<span class=\"token operator\">=</span><span class=\"token string\">\"5.2.3\"</span><span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span>div _ngcontent-c0<span class=\"token operator\">=</span><span class=\"token string\">\"\"</span> style<span class=\"token operator\">=</span><span class=\"token string\">\"text-align:center\"</span><span class=\"token operator\">></span>\n  <span class=\"token operator\">&lt;</span>h1 _ngcontent-c0<span class=\"token operator\">=</span><span class=\"token string\">\"\"</span><span class=\"token operator\">></span>\n    Welcome to app<span class=\"token operator\">!</span>\n  <span class=\"token operator\">&lt;</span>/h1<span class=\"token operator\">></span>\n  <span class=\"token operator\">&lt;</span>img _ngcontent-c0<span class=\"token operator\">=</span><span class=\"token string\">\"\"</span> alt<span class=\"token operator\">=</span><span class=\"token string\">\"Angular Logo\"</span> src<span class=\"token operator\">=</span><span class=\"token string\">\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNTAgMjUwIj4KICAgIDxwYXRoIGZpbGw9IiNERDAwMzEiIGQ9Ik0xMjUgMzBMMzEuOSA2My4ybDE0LjIgMTIzLjFMMTI1IDIzMGw3OC45LTQzLjcgMTQuMi0xMjMuMXoiIC8+CiAgICA8cGF0aCBmaWxsPSIjQzMwMDJGIiBkPSJNMTI1IDMwdjIyLjItLjFWMjMwbDc4LjktNDMuNyAxNC4yLTEyMy4xTDEyNSAzMHoiIC8+CiAgICA8cGF0aCAgZmlsbD0iI0ZGRkZGRiIgZD0iTTEyNSA1Mi4xTDY2LjggMTgyLjZoMjEuN2wxMS43LTI5LjJoNDkuNGwxMS43IDI5LjJIMTgzTDEyNSA1Mi4xem0xNyA4My4zaC0zNGwxNy00MC45IDE3IDQwLjl6IiAvPgogIDwvc3ZnPg==\"</span> width<span class=\"token operator\">=</span><span class=\"token string\">\"300\"</span><span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span>/div<span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span>h2 _ngcontent-c0<span class=\"token operator\">=</span><span class=\"token string\">\"\"</span><span class=\"token operator\">></span>Here are some links to <span class=\"token function\">help</span> you start: <span class=\"token operator\">&lt;</span>/h2<span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span>ul _ngcontent-c0<span class=\"token operator\">=</span><span class=\"token string\">\"\"</span><span class=\"token operator\">></span>\n  <span class=\"token operator\">&lt;</span>li _ngcontent-c0<span class=\"token operator\">=</span><span class=\"token string\">\"\"</span><span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span>h2 _ngcontent-c0<span class=\"token operator\">=</span><span class=\"token string\">\"\"</span><span class=\"token operator\">></span><span class=\"token operator\">&lt;</span>a _ngcontent-c0<span class=\"token operator\">=</span><span class=\"token string\">\"\"</span> href<span class=\"token operator\">=</span><span class=\"token string\">\"https://angular.io/tutorial\"</span> rel<span class=\"token operator\">=</span><span class=\"token string\">\"noopener\"</span> target<span class=\"token operator\">=</span><span class=\"token string\">\"_blank\"</span><span class=\"token operator\">></span>Tour of Heroes<span class=\"token operator\">&lt;</span>/a<span class=\"token operator\">></span><span class=\"token operator\">&lt;</span>/h2<span class=\"token operator\">></span>\n  <span class=\"token operator\">&lt;</span>/li<span class=\"token operator\">></span>\n  <span class=\"token operator\">&lt;</span>li _ngcontent-c0<span class=\"token operator\">=</span><span class=\"token string\">\"\"</span><span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span>h2 _ngcontent-c0<span class=\"token operator\">=</span><span class=\"token string\">\"\"</span><span class=\"token operator\">></span><span class=\"token operator\">&lt;</span>a _ngcontent-c0<span class=\"token operator\">=</span><span class=\"token string\">\"\"</span> href<span class=\"token operator\">=</span><span class=\"token string\">\"https://github.com/angular/angular-cli/wiki\"</span> rel<span class=\"token operator\">=</span><span class=\"token string\">\"noopener\"</span> target<span class=\"token operator\">=</span><span class=\"token string\">\"_blank\"</span><span class=\"token operator\">></span>CLI Documentation<span class=\"token operator\">&lt;</span>/a<span class=\"token operator\">></span><span class=\"token operator\">&lt;</span>/h2<span class=\"token operator\">></span>\n  <span class=\"token operator\">&lt;</span>/li<span class=\"token operator\">></span>\n  <span class=\"token operator\">&lt;</span>li _ngcontent-c0<span class=\"token operator\">=</span><span class=\"token string\">\"\"</span><span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span>h2 _ngcontent-c0<span class=\"token operator\">=</span><span class=\"token string\">\"\"</span><span class=\"token operator\">></span><span class=\"token operator\">&lt;</span>a _ngcontent-c0<span class=\"token operator\">=</span><span class=\"token string\">\"\"</span> href<span class=\"token operator\">=</span><span class=\"token string\">\"https://blog.angular.io/\"</span> rel<span class=\"token operator\">=</span><span class=\"token string\">\"noopener\"</span> target<span class=\"token operator\">=</span><span class=\"token string\">\"_blank\"</span><span class=\"token operator\">></span>Angular blog<span class=\"token operator\">&lt;</span>/a<span class=\"token operator\">></span><span class=\"token operator\">&lt;</span>/h2<span class=\"token operator\">></span>\n  <span class=\"token operator\">&lt;</span>/li<span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span>/ul<span class=\"token operator\">></span>\n\n<span class=\"token operator\">&lt;</span>/app-root<span class=\"token operator\">></span><span class=\"token operator\">&lt;</span>script type<span class=\"token operator\">=</span><span class=\"token string\">\"text/javascript\"</span> src<span class=\"token operator\">=</span><span class=\"token string\">\"inline.78b4ac51ac1cd84f71f4.bundle.js\"</span><span class=\"token operator\">></span><span class=\"token operator\">&lt;</span>/script<span class=\"token operator\">></span><span class=\"token operator\">&lt;</span>script type<span class=\"token operator\">=</span><span class=\"token string\">\"text/javascript\"</span> src<span class=\"token operator\">=</span><span class=\"token string\">\"polyfills.f20484b2fa4642e0dca8.bundle.js\"</span><span class=\"token operator\">></span><span class=\"token operator\">&lt;</span>/script<span class=\"token operator\">></span><span class=\"token operator\">&lt;</span>script type<span class=\"token operator\">=</span><span class=\"token string\">\"text/javascript\"</span> src<span class=\"token operator\">=</span><span class=\"token string\">\"main.fce2f23baeaafec1976c.bundle.js\"</span><span class=\"token operator\">></span><span class=\"token operator\">&lt;</span>/script<span class=\"token operator\">></span><span class=\"token operator\">&lt;</span>/body<span class=\"token operator\">></span><span class=\"token operator\">&lt;</span>/html<span class=\"token operator\">></span></code></pre><h3 id=\"pre-rendering-at-run-time\">Pre-rendering at run time</h3>\n<p>This approach is more typical. It is most appropriate for dynamic sites where data is constantly changing and requires setting up and deploying a web server, for which we&#39;ll use the popular node framework <a href=\"https://expressjs.com/\">Express</a> along with a custom <a href=\"https://github.com/angular/universal/tree/master/modules/express-engine\">engine</a> to automatically call the <code>renderModuleFactory</code> for each request and send the results to the browser.</p>\n<p>Start by installing <code>express</code>, <code>@types/express</code> and <code>@nguniversal/express-engine</code>:</p>\n<pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">npm</span> <span class=\"token function\">install</span> express @types/express @nguniversal/express-engine --save-dev</code></pre><p>In the projects root, create a file named <code>server.ts</code>:</p>\n<pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">touch</span> server.ts</code></pre><p>And add the following code:</p>\n<p><strong>server.ts</strong></p>\n<pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> readFileSync <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'fs'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> join <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'path'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">import</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">as</span> express <span class=\"token keyword\">from</span> <span class=\"token string\">'express'</span><span class=\"token punctuation\">;</span>                                              <span class=\"token comment\" spellcheck=\"true\">// Express framework.</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> ngExpressEngine <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@nguniversal/express-engine'</span><span class=\"token punctuation\">;</span>                  <span class=\"token comment\" spellcheck=\"true\">// Universal engine for Express.</span>\n\n<span class=\"token keyword\">import</span> <span class=\"token string\">'zone.js/dist/zone-node'</span><span class=\"token punctuation\">;</span>                                              <span class=\"token comment\" spellcheck=\"true\">// Node compatible version of `zone.js`. Required by Angular Universal.</span>\n<span class=\"token keyword\">import</span> <span class=\"token string\">'reflect-metadata'</span><span class=\"token punctuation\">;</span>                                                      <span class=\"token comment\" spellcheck=\"true\">// Metadata reflection API. Required by Angular Universal.</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> renderModuleFactory <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@angular/platform-server'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> AppServerModuleNgFactory <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./server/main.bundle.js'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>      <span class=\"token comment\" spellcheck=\"true\">// Compiled Angular application in CommonJS format. Notice that here, we're using `require` instead of `import`.</span>\n\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> enableProdMode <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@angular/core'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token function\">enableProdMode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> PORT <span class=\"token operator\">=</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span>PORT <span class=\"token operator\">||</span> <span class=\"token number\">4000</span><span class=\"token punctuation\">;</span>                                          <span class=\"token comment\" spellcheck=\"true\">// Port for the server.</span>\n<span class=\"token keyword\">const</span> DIST <span class=\"token operator\">=</span> <span class=\"token function\">join</span><span class=\"token punctuation\">(</span>process<span class=\"token punctuation\">.</span><span class=\"token function\">cwd</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'dist'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>                                      <span class=\"token comment\" spellcheck=\"true\">// Directory where build results from the Angular CLI are put.</span>\n<span class=\"token keyword\">const</span> DOCUMENT <span class=\"token operator\">=</span> <span class=\"token function\">readFileSync</span><span class=\"token punctuation\">(</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span>DIST<span class=\"token punctuation\">,</span> <span class=\"token string\">'browser'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'index.html'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'utf-8'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\" spellcheck=\"true\">// Document to be used as template.</span>\n\n<span class=\"token keyword\">let</span> app <span class=\"token operator\">=</span> <span class=\"token function\">express</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>                                                          <span class=\"token comment\" spellcheck=\"true\">// Create Express server.</span>\n\napp<span class=\"token punctuation\">.</span><span class=\"token function\">engine</span><span class=\"token punctuation\">(</span><span class=\"token string\">'html'</span><span class=\"token punctuation\">,</span> <span class=\"token function\">ngExpressEngine</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>                                          <span class=\"token comment\" spellcheck=\"true\">// Register Universal engine.</span>\n  bootstrap<span class=\"token punctuation\">:</span> AppServerModuleNgFactory\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\napp<span class=\"token punctuation\">.</span><span class=\"token keyword\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">'view engine'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'html'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>                                                  <span class=\"token comment\" spellcheck=\"true\">// Set view engine to HTML.</span>\napp<span class=\"token punctuation\">.</span><span class=\"token keyword\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">'views'</span><span class=\"token punctuation\">,</span> <span class=\"token function\">join</span><span class=\"token punctuation\">(</span>DIST<span class=\"token punctuation\">,</span> <span class=\"token string\">'browser'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\napp<span class=\"token punctuation\">.</span><span class=\"token keyword\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'*.*'</span><span class=\"token punctuation\">,</span> express<span class=\"token punctuation\">.</span><span class=\"token keyword\">static</span><span class=\"token punctuation\">(</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span>DIST<span class=\"token punctuation\">,</span> <span class=\"token string\">'browser'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> maxAge<span class=\"token punctuation\">:</span> <span class=\"token string\">'1y'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>      <span class=\"token comment\" spellcheck=\"true\">// Serve static files from `${ DIST }/browser`.</span>\napp<span class=\"token punctuation\">.</span><span class=\"token keyword\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'*'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>req<span class=\"token punctuation\">,</span> res<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span> res<span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token string\">'index'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> req <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>                  <span class=\"token comment\" spellcheck=\"true\">// Use the Universal engine for all other routes.</span>\n\napp<span class=\"token punctuation\">.</span><span class=\"token function\">listen</span><span class=\"token punctuation\">(</span>PORT<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>                                                      <span class=\"token comment\" spellcheck=\"true\">// Start the server.</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token string\">`Express server listening on http://localhost:</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span> PORT <span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre><p>Again, prior to execution run the TypeScript compiler to transpile the code:</p>\n<pre class=\"language-bash\"><code class=\"language-bash\">node_modules/.bin/tsc --project tsconfig.server.json</code></pre><p>If you haven&#39;t done so already, build both apps:</p>\n<pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">npm</span> run build:browser <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">npm</span> run build:server</code></pre><p>Then start the server:</p>\n<pre class=\"language-bash\"><code class=\"language-bash\">node dist/server.js</code></pre><p>You should get the following output:</p>\n<pre class=\"language-bash\"><code class=\"language-bash\">Express server listening on http://localhost:4000</code></pre><p>If you open up the browser on the above location and inspect the source, it should look like this:</p>\n<pre class=\"language-markup\"><code class=\"language-markup\"><span class=\"token doctype\">&lt;!DOCTYPE html></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>html</span> <span class=\"token attr-name\">lang</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>en<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>head</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">charset</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>utf-8<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>title</span><span class=\"token punctuation\">></span></span>IntroductionToAngularUniversal<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>title</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>base</span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>/<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>viewport<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">content</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>width<span class=\"token punctuation\">=</span>device-width,initial-scale<span class=\"token punctuation\">=</span>1<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>link</span> <span class=\"token attr-name\">rel</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>icon<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>image/x-icon<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>favicon.ico<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>link</span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>styles.9c0ad738f18adc3d19ed.bundle.css<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">rel</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>stylesheet<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>style</span> <span class=\"token attr-name\">ng-transition</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>my-app-id<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>style</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>head</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>body</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>app-root</span> <span class=\"token attr-name\">_nghost-c0</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span><span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">ng-version</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>5.2.3<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">_ngcontent-c0</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span><span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">style</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>text-align:center<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h1</span> <span class=\"token attr-name\">_ngcontent-c0</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span><span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    Welcome to app!\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h1</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>img</span> <span class=\"token attr-name\">_ngcontent-c0</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span><span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">alt</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>Angular Logo<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNTAgMjUwIj4KICAgIDxwYXRoIGZpbGw9IiNERDAwMzEiIGQ9Ik0xMjUgMzBMMzEuOSA2My4ybDE0LjIgMTIzLjFMMTI1IDIzMGw3OC45LTQzLjcgMTQuMi0xMjMuMXoiIC8+CiAgICA8cGF0aCBmaWxsPSIjQzMwMDJGIiBkPSJNMTI1IDMwdjIyLjItLjFWMjMwbDc4LjktNDMuNyAxNC4yLTEyMy4xTDEyNSAzMHoiIC8+CiAgICA8cGF0aCAgZmlsbD0iI0ZGRkZGRiIgZD0iTTEyNSA1Mi4xTDY2LjggMTgyLjZoMjEuN2wxMS43LTI5LjJoNDkuNGwxMS43IDI5LjJIMTgzTDEyNSA1Mi4xem0xNyA4My4zaC0zNGwxNy00MC45IDE3IDQwLjl6IiAvPgogIDwvc3ZnPg<span class=\"token punctuation\">=</span><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">width</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>300<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h2</span> <span class=\"token attr-name\">_ngcontent-c0</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span><span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Here are some links to help you start: <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h2</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>ul</span> <span class=\"token attr-name\">_ngcontent-c0</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span><span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>li</span> <span class=\"token attr-name\">_ngcontent-c0</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span><span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h2</span> <span class=\"token attr-name\">_ngcontent-c0</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span><span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>a</span> <span class=\"token attr-name\">_ngcontent-c0</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span><span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>https://angular.io/tutorial<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">rel</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>noopener<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">target</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>_blank<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Tour of Heroes<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>a</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h2</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>li</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>li</span> <span class=\"token attr-name\">_ngcontent-c0</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span><span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h2</span> <span class=\"token attr-name\">_ngcontent-c0</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span><span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>a</span> <span class=\"token attr-name\">_ngcontent-c0</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span><span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>https://github.com/angular/angular-cli/wiki<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">rel</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>noopener<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">target</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>_blank<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>CLI Documentation<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>a</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h2</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>li</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>li</span> <span class=\"token attr-name\">_ngcontent-c0</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span><span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h2</span> <span class=\"token attr-name\">_ngcontent-c0</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span><span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>a</span> <span class=\"token attr-name\">_ngcontent-c0</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span><span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>https://blog.angular.io/<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">rel</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>noopener<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">target</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>_blank<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Angular blog<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>a</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h2</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>li</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>ul</span><span class=\"token punctuation\">></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>app-root</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>text/javascript<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>inline.78b4ac51ac1cd84f71f4.bundle.js<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>text/javascript<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>polyfills.f20484b2fa4642e0dca8.bundle.js<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>text/javascript<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>main.fce2f23baeaafec1976c.bundle.js<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>body</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>html</span><span class=\"token punctuation\">></span></span></code></pre><h2 id=\"conclusion\">Conclusion</h2>\n<p>Congratulations! You&#39;ve built a genuine Angular Universal application! </p>\n<p>This guide walked you through the process of integrating Angular Universal into an existing CLI generated project and introduced you to the basics of server-side rendering (or pre-rendering) --- a technique used to improve perceived startup performance and facilitate web crawlers. </p>\n<p>But this is just the tip of the iceberg in the ocean of possibilities on the subject. In the upcoming articles we&#39;ll explore more advanced topics.</p>\n","year":"2018","month":"02","day":"06","monthName":"February","dayName":"Tuesday","time":"","timezone":"","readingTime":"16 minute read","excerpt":"\n\nAs of Angular 4.0, Angular Universal, which initially started as a community-driven project, is pa"}